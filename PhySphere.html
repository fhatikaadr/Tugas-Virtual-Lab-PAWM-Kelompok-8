<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhySphere ‚Äî GHS (Modern)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --purple-50:#f3e8ff; --purple-100:#e9d5ff; --purple-500:#a855f7; --purple-600:#9333ea; --yellow-400:#fde047; --yellow-300:#fde68a; --glass: rgba(255,255,255,0.6);
    }
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,var(--purple-50),#fefce8);}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.7),rgba(255,255,255,0.85));backdrop-filter:blur(6px);box-shadow:0 8px 24px rgba(168,85,247,0.08);border-radius:16px;padding:1rem}
    .vlab-button{padding:.6rem 1rem;border-radius:12px;font-weight:600;box-shadow:0 8px 20px rgba(168,85,247,0.08);}
    .tab-button.active{border-bottom:3px solid var(--purple-500);color:var(--purple-600);background:var(--yellow-300);}
    input[type=range]{-webkit-appearance:none;height:8px;border-radius:999px;background:#e6eefc}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--blue-500);box-shadow:0 4px 12px rgba(59,130,246,0.25)}
    /* quiz specific */
    .question-card{transition:transform .22s ease, box-shadow .22s ease}
    .question-card:hover{transform:translateY(-4px);box-shadow:0 14px 40px rgba(2,6,23,0.08)}
    .chip{background:rgba(59,130,246,0.12);color:var(--blue-600);padding:.25rem .5rem;border-radius:999px;font-weight:600}
    .badge{background:var(--blue-500);color:#fff;padding:.25rem .6rem;border-radius:8px;font-weight:700}
    .ordering-list{list-style:none;padding:0;margin:0}
    .ordering-item{padding:.6rem;border-radius:10px;background:#fff;border:1px dashed #e6eefc;cursor:grab;margin-bottom:.5rem}
    /* module visibility helper */
    .module-hidden{display:none!important}
    /* small typography helpers for inserted prose */
    .prose h4{margin-top:1rem;margin-bottom:.4rem;font-weight:700;color:rgba(17,24,39,0.85)}
    .prose h5{margin-top:.8rem;margin-bottom:.3rem;font-weight:600}
    .prose p{margin:.45rem 0;color:rgba(31,41,55,0.85);line-height:1.6}
  /* quiz result highlights */
  .q-correct{background:#dcfce7;border:1px solid #16a34a}
  .q-wrong{background:#fee2e2;border:1px solid #ef4444}
  /* per-topic result and completed badge */
  .topic-result{background:linear-gradient(180deg,#fff,#fbfbff);border-radius:12px;padding:.6rem;margin-top:.6rem;border:1px solid #eef2ff}
  .quiz-completed{box-shadow:0 8px 24px rgba(16,185,129,0.06);border-left:6px solid #10b981}
  .completed-badge{background:#10b981;color:#fff;padding:.25rem .5rem;border-radius:999px;font-weight:700;font-size:.8rem}
  /* finished layout: compact badge style (kept simpler for compatibility) */
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-7xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <!-- Use relative path to img folder; space in filename is URL-encoded -->
        <img src="img/logo%20PhySphere.png" alt="PhySphere Logo" class="h-20 w-auto object-contain">
        <div>
          <h1 class="text-2xl font-bold text-purple-800">Gerak Harmonik Sederhana</h1>
          <p class="text-sm text-purple-500">Simulasi, kuis, dan materi fisika.</p>
        </div>
      </div>
      <nav class="flex gap-3">
        <button class="tab-button py-2 px-3 text-purple-700" data-page="beranda">Beranda</button>
        <button class="tab-button active py-2 px-3 text-purple-700" data-page="materi">Materi</button>
        <button class="tab-button py-2 px-3 text-purple-700" data-page="vlab">PhySphere Lab</button>
        <button class="tab-button py-2 px-3 text-purple-700" data-page="quiz">Kuis</button>
        <button class="tab-button py-2 px-3 text-purple-700" data-page="profile">Profil</button>
      </nav>
    </header>

    <main>
      <!-- BERANDA -->
      <section id="beranda-page" class="page card mb-6 hidden">
        <div class="text-center py-8">
          <h2 class="text-4xl font-extrabold text-purple-700 mb-2">Selamat Datang di <span class="text-yellow-400">PhySphere</span></h2>
          <p class="text-lg text-purple-900 mb-6">Pelajari Fisika dengan cara yang menyenangkan dan interaktif ‚ú®</p>
          <div class="grid md:grid-cols-2 gap-8 justify-center mb-10">
            <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
              <img src="https://img.icons8.com/color/96/000000/books.png" alt="Materi" class="mb-4"/>
              <h3 class="font-bold text-xl text-purple-700 mb-2">Materi Pembelajaran</h3>
              <p class="text-slate-600 text-center">Pelajari konsep dasar fisika seperti GHS, Hukum Newton, dan lainnya secara interaktif üìö</p>
            </div>
            <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
              <img src="https://img.icons8.com/color/96/000000/quiz.png" alt="Quiz" class="mb-4"/>
              <h3 class="font-bold text-xl text-purple-700 mb-2">Kuis Interaktif</h3>
              <p class="text-slate-600 text-center">Uji pemahaman Anda dengan kuis yang menarik dan interaktif ‚úçÔ∏è</p>
            </div>
          </div>
          <h3 class="text-2xl font-bold text-purple-700 mb-6">Fitur Unggulan</h3>
          <div class="grid md:grid-cols-3 gap-8 mb-10">
            <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
              <img src="https://img.icons8.com/color/96/000000/particle.png" alt="Simulasi" class="mb-4"/>
              <h4 class="font-semibold text-lg text-purple-700 mb-2">Simulasi Interaktif</h4>
              <p class="text-slate-600 text-center">Lihat konsep fisika dalam bentuk animasi yang menarik</p>
            </div>
            <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
              <img src="https://img.icons8.com/color/96/000000/video.png" alt="Video" class="mb-4"/>
              <h4 class="font-semibold text-lg text-purple-700 mb-2">Video Pembelajaran</h4>
              <p class="text-slate-600 text-center">Pelajari melalui video penjelasan yang komprehensif</p>
            </div>
            <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
              <img src="https://img.icons8.com/color/96/000000/clock--v1.png" alt="Realtime" class="mb-4"/>
              <h4 class="font-semibold text-lg text-purple-700 mb-2">Pembaruan Real-time</h4>
              <p class="text-slate-600 text-center">Selalu terhubung, selalu terkini dengan update real-time</p>
            </div>
          </div>
          <div class="mt-8">
            <button class="vlab-button bg-purple-700 text-yellow-300 hover:bg-purple-800 px-8 py-3 text-lg font-bold shadow-lg transition">Mulai Belajar Sekarang</button>
          </div>
        </div>
      </section>
      <!-- MATERI (modul + sidebar progress) -->
      <section id="materi-page" class="page card mb-6">
        <div class="grid md:grid-cols-4 gap-6">
          <!-- Sidebar: daftar modul + progress -->
          <aside class="md:col-span-1">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">Daftar Materi</h3>
            <ul id="materi-list" class="space-y-2 mb-6">
              <li><button class="materi-link w-full text-left py-3 px-4 rounded-md bg-white border hover:bg-gray-50" data-target="getaran">Getaran & Gelombang</button></li>
              <li><button class="materi-link w-full text-left py-3 px-4 rounded-md bg-white border hover:bg-gray-50" data-target="ghs">Gerak Harmonik Sederhana (GHS)</button></li>
              <li><button class="materi-link w-full text-left py-3 px-4 rounded-md bg-white border hover:bg-gray-50" data-target="bandul">Bandul</button></li>
              <li><button class="materi-link w-full text-left py-3 px-4 rounded-md bg-white border hover:bg-gray-50" data-target="pegas">Pegas</button></li>
            </ul>

            <div class="p-4 bg-white rounded-xl border">
              <h4 class="font-semibold text-slate-800 mb-2">Progress Membaca</h4>
              <div class="progress-bar mb-2" style="height:0.6rem;background:#e6eefc;border-radius:999px;">
                <div id="materi-progress-fill" class="progress-fill" style="width:0%;height:100%;background:linear-gradient(90deg,#7c3aed,#06b6d4);border-radius:999px;transition:width .4s"></div>
              </div>
              <div class="text-sm text-slate-600"><span id="materi-progress-percent">0%</span> selesai</div>
            </div>
          </aside>

          <!-- Konten modul -->
          <div class="md:col-span-3 space-y-6">
            <h2 class="text-2xl font-bold text-slate-800">Materi Pembelajaran</h2>

            <!-- Modul: Getaran & Gelombang -->
            <article id="getaran" class="p-6 bg-white rounded-xl border">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-xl font-semibold text-slate-800">Getaran & Gelombang</h3>
                  <p class="text-sm text-slate-600 mt-2">Pengantar tentang getaran, gelombang, amplitudo, frekuensi, dan contoh sehari-hari.</p>
                </div>
                <div>
                  <button class="mark-read vlab-button bg-blue-600 text-white" data-module="getaran">Tandai Dibaca</button>
                </div>
              </div>
              <div class="mt-4">
                <div class="aspect-w-16 aspect-h-9" style="position:relative;padding-top:56.25%;">
                  <iframe src="https://www.youtube.com/embed/wglGwxYFPpM?list=PLovW1TU0Q47w2mlnQ5yitzleSq_9Dh75O" title="Video Getaran Gelombang" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allowfullscreen></iframe>
                </div>
              </div>
              <!-- Concise content: pengertian, contoh, besaran, rumus singkat, gelombang -->
              <div class="mt-6 prose text-slate-700">
                <h4>Pengertian Getaran</h4>
                <p>Getaran adalah gerak bolak-balik suatu benda melewati titik setimbang. Satu periode adalah waktu untuk satu getaran penuh (kembali ke posisi semula).</p>

                <h5>Contoh ‚Äî Bandul</h5>
                <p>Bandul bergetar bolak-balik di sekitar titik setimbang; simpangan terjauh disebut amplitudo. Satu getaran penuh misalnya A‚ÜíB‚ÜíC‚ÜíB‚ÜíA.</p>

                <h4>Besaran Penting</h4>
                <ul>
                  <li><strong>Periode (T)</strong>: waktu satu getaran (s).</li>
                  <li><strong>Frekuensi (f)</strong>: jumlah getaran per detik (Hz).</li>
                  <li><strong>Simpangan / Amplitudo (x / A)</strong>: jarak dari titik setimbang (m).</li>
                </ul>

                <h4>Rumus Singkat</h4>
                <p>Contoh: pegas/GHS ‚Üí T = 2œÄ‚àö(m/k). Bandul kecil ‚Üí T = 2œÄ‚àö(L/g).</p>

                <h3 class="mt-4">Gelombang (singkat)</h3>
                <p>Gelombang adalah perambatan gangguan/energi dari satu titik ke titik lain (contoh: riak air, gelombang suara).</p>

                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <h5>Klasifikasi (medium)</h5>
                    <ul>
                      <li><strong>Mekanik</strong>: butuh medium (contoh: bunyi).</li>
                      <li><strong>Elektromagnetik</strong>: tak butuh medium (contoh: cahaya).</li>
                    </ul>
                  </div>
                  <div>
                    <h5>Klasifikasi (arah rambat)</h5>
                    <ul>
                      <li><strong>Longitudinal</strong>: getaran sejajar arah rambat.</li>
                      <li><strong>Transversal</strong>: getaran tegak lurus arah rambat.</li>
                    </ul>
                  </div>
                </div>

                <h4 class="mt-3">Sifat Utama</h4>
                <p>Gelombang dapat dipantulkan, dipadukan (superposisi), dibiaskan (refraksi), dan dilenturkan (difraksi).</p>

                <p class="mt-3 text-sm text-slate-500">Sumber ringkasan: <a href="https://www.ruangguru.com/blog/perbedaan-getaran-dan-gelombang" target="_blank" rel="noopener">ruangguru.com</a></p>
              </div>
            </article>

            <!-- Modul: GHS -->
            <article id="ghs" class="p-6 bg-white rounded-xl border">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-xl font-semibold text-slate-800">Gerak Harmonik Sederhana (GHS)</h3>
                  <p class="text-sm text-slate-600 mt-2">Konsep GHS, hukum Hooke, periode, frekuensi, energi.</p>
                </div>
                <div>
                  <button class="mark-read vlab-button bg-blue-600 text-white" data-module="ghs">Tandai Dibaca</button>
                </div>
              </div>
              <div class="mt-4">
                <div class="aspect-w-16 aspect-h-9" style="position:relative;padding-top:56.25%;">
                  <iframe src="https://www.youtube.com/embed/q2Hnk39kIe4" title="Video GHS" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allowfullscreen></iframe>
                </div>
              </div>
              <!-- GHS detailed section (formatted) -->
              <div class="mt-6 prose text-slate-700">
                <header class="mb-3">
                  <h3 class="text-xl font-bold">Gerak Harmonik Sederhana: Pengertian, Analisis, dan Contoh</h3>
                  <div class="text-sm text-slate-500">Superadmin ‚Ä¢ 9 March 2023 ‚Ä¢ 10 Minute Read</div>
                </header>

                <section>
                  <h4>Ringkasan</h4>
                  <p>Gerak Harmonik Sederhana (GHS) adalah gerak periodik bolak-balik di sekitar titik kesetimbangan yang dapat dianalisis secara matematis menggunakan fungsi sinus/ cosinus. Contoh: bandul dan pegas.</p>
                </section>

                <section>
                  <h4>Faktor yang Mempengaruhi</h4>
                  <ul>
                    <li><strong>Massa (m)</strong> ‚Äî Semakin besar massa, periode umumnya bertambah (T ‚Üë).</li>
                    <li><strong>Konstanta Pegas (k)</strong> ‚Äî Semakin k besar, periode berkurang (T ‚Üì).</li>
                    <li><strong>Amplitudo (A)</strong> ‚Äî Pada GHS ideal periode tidak bergantung kuat pada A untuk amplitudo kecil.</li>
                    <li><strong>Gaya Gesek</strong> ‚Äî Dapat meredam gerakan dan mengubah periode/energi jika signifikan.</li>
                  </ul>
                </section>

                <section>
                  <h4>Analisis Singkat</h4>
                  <p>Simpangan pada GHS sering ditulis sebagai:</p>
                  <p class="font-mono">y(t) = A sin(œâ t)</p>
                  <p>Dengan œâ = 2œÄ f dan hubungan penting:</p>
                  <p class="font-mono">T = 2œÄ ‚àö(m / k) &nbsp; &nbsp; œâ = ‚àö(k / m)</p>
                  <p>Kecepatan dan percepatan dihasilkan dari turunan waktu:</p>
                  <p class="font-mono">v(t) = A œâ cos(œâ t) &nbsp; &nbsp; a(t) = ‚àíA œâ¬≤ sin(œâ t) = ‚àíœâ¬≤ y(t)</p>
                </section>

                <section>
                  <h4>Contoh Singkat</h4>
                  <p>Jika k = 10 N/m dan m = 1 kg, maka œâ = ‚àö(10/1) ‚âà 3.162 rad/s dan T = 2œÄ/œâ ‚âà 1.987 s.</p>
                </section>

                <footer class="mt-4 text-sm text-slate-500">
                  <p>Sumber ringkasan: <a href="https://www.pijarbelajar.id/blog/gerak-harmonik-sederhana" target="_blank" rel="noopener">pijarbelajar.id</a></p>
                </footer>
              </div>
            </article>

            <!-- Modul: Bandul -->
            <article id="bandul" class="p-6 bg-white rounded-xl border">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-xl font-semibold text-slate-800">Bandul</h3>
                  <p class="text-sm text-slate-600 mt-2">Bandul matematis: periode, sudut kecil, dan contoh eksperimen.</p>
                </div>
                <div>
                  <button class="mark-read vlab-button bg-blue-600 text-white" data-module="bandul">Tandai Dibaca</button>
                </div>
              </div>
              <div class="mt-4">
                <div class="aspect-w-16 aspect-h-9" style="position:relative;padding-top:56.25%;">
                  <iframe src="https://www.youtube.com/embed/jnDb4JWf9ps" title="Video Bandul" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allowfullscreen></iframe>
                </div>
              </div>
              <!-- Bandul: concise, well-formatted explanation -->
              <div class="mt-6 prose text-slate-700">
                <h4>Bandul ‚Äî Definisi Singkat</h4>
                <p>Bandul adalah beban yang digantungkan pada tali sehingga dapat berayun bebas dan periodik akibat gravitasi. Gerak bandul mendekati Gerak Harmonik Sederhana (GHS) bila sudut simpangannya kecil.</p>

                <h5>Komponen & Gerak</h5>
                <p>Bandul terdiri dari massa (beban) yang terhubung ke titik tumpu melalui tali. Bila ditarik dan dilepaskan, bandul bergerak bolak-balik melintasi posisi setimbangnya.</p>

                <h5>Persamaan Periode</h5>
                <p>Periode bandul yang ideal (sudut kecil) hanya bergantung pada panjang tali <em>L</em> dan percepatan gravitasi <em>g</em>:</p>
                <p class="font-mono">T = 2œÄ ‚àö(L / g)</p>

                <h5>Besaran yang Terlibat</h5>
                <ul>
                  <li><strong>Periode (T)</strong> ‚Äî Waktu satu ayunan penuh.</li>
                  <li><strong>Amplitudo</strong> ‚Äî Simpangan terjauh dari titik setimbang.</li>
                  <li><strong>Frekuensi</strong> ‚Äî Jumlah ayunan per satuan waktu.</li>
                </ul>

                <h5>Faktor yang Mempengaruhi</h5>
                <p>Periode dipengaruhi oleh panjang tali <em>L</em> dan percepatan gravitasi <em>g</em>. Untuk bandul sederhana, massa benda tidak mempengaruhi periode.</p>

                <h5>Catatan</h5>
                <p>Pada amplitudo kecil (biaa ¬±10¬∞), periode tidak bergantung signifikan pada amplitudo. Gaya gesek akan menyebabkan peredaman sehingga gerak tidak ideal lagi.</p>
              </div>
            </article>

            <!-- Modul: Pegas -->
            <article id="pegas" class="p-6 bg-white rounded-xl border">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-xl font-semibold text-slate-800">Pegas</h3>
                  <p class="text-sm text-slate-600 mt-2">Hukum Hooke, konstanta pegas, dan hubungan dengan GHS.</p>
                </div>
                <div>
                  <button class="mark-read vlab-button bg-blue-600 text-white" data-module="pegas">Tandai Dibaca</button>
                </div>
              </div>
              <div class="mt-4">
                <div class="aspect-w-16 aspect-h-9" style="position:relative;padding-top:56.25%;">
                  <iframe src="https://www.youtube.com/embed/nVkj6GrHIn8" title="Video Pegas" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allowfullscreen></iframe>
                </div>
              </div>
              <!-- Pegas: concise and tidy section -->
              <div class="mt-6 prose text-slate-700">
                <h4>Pengenalan Pegas</h4>
                <p>Pegas adalah benda elastis yang dapat menyimpan energi mekanik dan kembali ke bentuk semula setelah diberi gaya. Sifat elastisnya dijelaskan oleh Hukum Hooke.</p>

                <h5>Hukum Hooke</h5>
                <p>Hukum Hooke menyatakan bahwa gaya pemulih pada pegas berbanding lurus dengan pertambahan panjangnya:</p>
                <p class="font-mono">F = k ¬∑ Œîx</p>
                <p>Di mana <em>k</em> adalah konstanta pegas dan Œîx adalah perubahan panjang.</p>

                <h5>Energi Potensial Elastis</h5>
                <p>Pegas yang ditekan atau ditarik menyimpan energi potensial elastis sebesar:</p>
                <p class="font-mono">E = ¬Ω k Œîx¬≤</p>

                <h5>Sifat & Karakteristik</h5>
                <ul>
                  <li><strong>Elastisitas</strong>: kemampuan kembali ke bentuk semula.</li>
                  <li><strong>Linearitas</strong>: untuk rentang kecil, gaya berbanding lurus dengan Œîx.</li>
                  <li><strong>Perilaku dinamis</strong>: pegas + massa dapat menghasilkan GHS dengan œâ = ‚àö(k/m).</li>
                </ul>

                <h5>Aplikasi Singkat</h5>
                <p>Pegas dipakai pada suspensi kendaraan, perangkat mekanik, jam-jam tertentu, serta berbagai perangkat elektronika dan alat pengukur.</p>
              </div>
            </article>

          </div>
        </div>
      </section>

      <!-- VLAB -->
      <section id="vlab-page" class="page hidden card mb-6">
        <h2 class="text-lg font-bold text-slate-800">PhySphere Lab ‚Äî Simulasi Interaktif</h2>
        <div class="grid md:grid-cols-3 gap-6 mt-4">
          <div class="col-span-1 space-y-4">
            <div class="p-4 bg-white rounded-xl border">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm text-slate-500">Mode</div>
                  <div class="text-sm font-semibold text-slate-800" id="vlab-mode-label">Pegas</div>
                </div>
                <div class="flex gap-2">
                  <button id="mode-pegas" class="vlab-button bg-blue-500 text-white">Pegas</button>
                  <button id="mode-bandul" class="vlab-button bg-white text-slate-700 border">Bandul</button>
                </div>
              </div>
              <div class="mt-4 space-y-3">
                <!-- Pegas controls -->
                <div class="pegas-controls">
                  <label class="block text-xs text-slate-500">Massa: <span id="m-val">1.00</span> kg</label>
                  <input id="mass-slider" type="range" min="0.1" max="5" step="0.1" value="1">
                  <label class="block text-xs text-slate-500">Konstanta Pegas: <span id="k-val">10.00</span> N/m</label>
                  <input id="k-slider" type="range" min="1" max="50" step="1" value="10">
                  <label class="block text-xs text-slate-500">Amplitudo: <span id="a-val">0.50</span> m</label>
                  <input id="amp-slider" type="range" min="0.01" max="1.5" step="0.01" value="0.5">
                </div>

                <!-- Bandul controls -->
                <div class="bandul-controls hidden">
                  <label class="block text-xs text-slate-500">Panjang Tali (L): <span id="L-val">1.00</span> m</label>
                  <input id="length-slider" type="range" min="0.1" max="5" step="0.1" value="1">
                  <label class="block text-xs text-slate-500">Percepatan Gravitasi (g): <span id="g-val">9.81</span> m/s¬≤</label>
                  <input id="g-slider" type="range" min="1" max="20" step="0.01" value="9.81">
                  <label class="block text-xs text-slate-500">Sudut Awal (Œ∏): <span id="theta-val">10</span> ¬∞</label>
                  <input id="theta-slider" type="range" min="1" max="45" step="1" value="10">
                </div>

                <div class="pt-2 flex gap-2">
                  <button id="start-btn" class="vlab-button bg-green-500 text-white w-full">Mulai Simulasi</button>
                  <button id="reset-btn" class="vlab-button bg-white border w-full">Reset</button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-span-2 bg-slate-50 rounded-xl p-4">
            <div style="aspect-ratio:16/9;" class="rounded-xl overflow-hidden bg-gradient-to-b from-slate-800 to-slate-700">
              <canvas id="physicsCanvas" width="1200" height="675"></canvas>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-4">
              <div class="p-4 bg-white rounded-xl border">
                <h4 class="font-semibold">Output Real-time</h4>
                <p class="text-sm text-slate-600">Nilai yang diperbarui selama simulasi.</p>
                <div class="mt-3 text-sm space-y-1">
                  <div>Mode: <span id="vlab-mode-display">Pegas</span></div>
                  <div>Periode (T): <span id="vlab-period">--</span> s</div>
                  <div>Frekuensi Sudut (œâ): <span id="vlab-omega">--</span> rad/s</div>
                  <div>Posisi (x / Œ∏): <span id="vlab-pos">--</span></div>
                  <div>Kecepatan: <span id="vlab-vel">--</span></div>
                  <div>Percepatan: <span id="vlab-acc">--</span></div>
                  <div>Energi Potensial (EP): <span id="vlab-ep">--</span> J</div>
                  <div>Energi Kinetik (EK): <span id="vlab-ek">--</span> J</div>
                  <div class="font-bold">Energi Total (ET): <span id="vlab-et">--</span> J</div>
                </div>
              </div>

              <div class="p-4 bg-white rounded-xl border">
                <h4 class="font-semibold">Kontrol & Rekam</h4>
                <div class="mt-3 space-y-2">
                  <button id="vlab-start" class="vlab-button bg-green-500 text-white w-full">Mulai</button>
                  <button id="vlab-pause" class="vlab-button bg-yellow-500 text-white w-full">Jeda</button>
                  <button id="vlab-reset" class="vlab-button bg-red-500 text-white w-full">Reset</button>
                  <div class="flex gap-2">
                    <button id="vlab-record" class="vlab-button bg-blue-600 text-white flex-1">Rekam</button>
                    <button id="vlab-download" class="vlab-button bg-white border flex-1">Download CSV</button>
                  </div>
                </div>
                <p class="text-xs text-slate-500 mt-2">Tips: Gunakan slider di kolom kiri untuk mengubah parameter sebelum memulai.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- QUIZ: Full-featured inspired by MyPhysicsLab (multiple parts, timer, nav, review, retry) -->
      <section id="quiz-page" class="page hidden card">
        <div class="flex items-start justify-between">
          <div>
            <h2 class="text-lg font-bold text-slate-800">Kuis Interaktif</h2>
            <p class="text-sm text-slate-500">Empat topik: Getaran & Gelombang, GHS, Bandul, Pegas ‚Äî masing-masing 3 soal (1 Pilgan, 1 Urutan, 1 Isian). Total 12 soal ‚Äî waktu 2 menit.</p>
          </div>
          <div class="text-right">
            <div class="mt-2 text-sm text-slate-500">Skor: <span id="live-score">0</span></div>
          </div>
        </div>

        <div class="mt-6 grid md:grid-cols-4 gap-4">
          <div class="md:col-span-3">
            <div id="quiz-sections" class="space-y-4">
              <div id="quiz-getaran" class="p-4 bg-white rounded-xl">
                <h3 class="font-semibold">Kuis ‚Äî Getaran & Gelombang</h3>
                <p class="text-sm text-slate-600">3 soal ‚Äî 2 menit.</p>
                <div class="mt-3 flex gap-2">
                  <button data-topic="getaran" class="start-topic vlab-button bg-blue-500 text-white">Mulai</button>
                  <button data-topic="getaran" class="submit-topic vlab-button bg-indigo-600 text-white">Kirim</button>
                  <button data-topic="getaran" class="review-topic vlab-button bg-white border">Rangkuman</button>
                  <button data-topic="getaran" class="retry-topic vlab-button bg-white border">Ulangi</button>
                </div>
                  <div id="result-getaran" class="topic-result">Belum dikerjakan.</div>
                  <div id="question-container-getaran" class="mt-3"></div>
                  <div id="question-nav-getaran" class="mt-3 grid grid-cols-5 gap-2"></div>
                <div class="mt-2 text-sm text-slate-500">Sisa Waktu: <span id="timer-getaran">02:00</span></div>
              </div>

              <div id="quiz-ghs" class="p-4 bg-white rounded-xl">
                <h3 class="font-semibold">Kuis ‚Äî GHS</h3>
                <p class="text-sm text-slate-600">3 soal ‚Äî 2 menit.</p>
                <div class="mt-3 flex gap-2">
                  <button data-topic="ghs" class="start-topic vlab-button bg-blue-500 text-white">Mulai</button>
                  <button data-topic="ghs" class="submit-topic vlab-button bg-indigo-600 text-white">Kirim</button>
                  <button data-topic="ghs" class="review-topic vlab-button bg-white border">Rangkuman</button>
                  <button data-topic="ghs" class="retry-topic vlab-button bg-white border">Ulangi</button>
                </div>
                  <div id="result-ghs" class="topic-result">Belum dikerjakan.</div>
                  <div id="question-container-ghs" class="mt-3"></div>
                  <div id="question-nav-ghs" class="mt-3 grid grid-cols-5 gap-2"></div>
                <div class="mt-2 text-sm text-slate-500">Sisa Waktu: <span id="timer-ghs">02:00</span></div>
              </div>

              <div id="quiz-bandul" class="p-4 bg-white rounded-xl">
                <h3 class="font-semibold">Kuis ‚Äî Bandul</h3>
                <p class="text-sm text-slate-600">3 soal ‚Äî 2 menit.</p>
                <div class="mt-3 flex gap-2">
                  <button data-topic="bandul" class="start-topic vlab-button bg-blue-500 text-white">Mulai</button>
                  <button data-topic="bandul" class="submit-topic vlab-button bg-indigo-600 text-white">Kirim</button>
                  <button data-topic="bandul" class="review-topic vlab-button bg-white border">Rangkuman</button>
                  <button data-topic="bandul" class="retry-topic vlab-button bg-white border">Ulangi</button>
                </div>
                  <div id="result-bandul" class="topic-result">Belum dikerjakan.</div>
                  <div id="question-container-bandul" class="mt-3"></div>
                  <div id="question-nav-bandul" class="mt-3 grid grid-cols-5 gap-2"></div>
                <div class="mt-2 text-sm text-slate-500">Sisa Waktu: <span id="timer-bandul">02:00</span></div>
              </div>

              <div id="quiz-pegas" class="p-4 bg-white rounded-xl">
                <h3 class="font-semibold">Kuis ‚Äî Pegas</h3>
                <p class="text-sm text-slate-600">3 soal ‚Äî 2 menit.</p>
                <div class="mt-3 flex gap-2">
                  <button data-topic="pegas" class="start-topic vlab-button bg-blue-500 text-white">Mulai</button>
                  <button data-topic="pegas" class="submit-topic vlab-button bg-indigo-600 text-white">Kirim</button>
                  <button data-topic="pegas" class="review-topic vlab-button bg-white border">Rangkuman</button>
                  <button data-topic="pegas" class="retry-topic vlab-button bg-white border">Ulangi</button>
                </div>
                  <div id="result-pegas" class="topic-result">Belum dikerjakan.</div>
                  <div id="question-container-pegas" class="mt-3"></div>
                  <div id="question-nav-pegas" class="mt-3 grid grid-cols-5 gap-2"></div>
                <div class="mt-2 text-sm text-slate-500">Sisa Waktu: <span id="timer-pegas">02:00</span></div>
              </div>
            </div>
          </div>

          <aside class="md:col-span-1">
            <div class="p-4 bg-white rounded-xl space-y-3">
              <h4 class="font-semibold text-slate-800">Navigasi Soal</h4>
              <div id="question-nav" class="grid grid-cols-5 gap-2 mt-2"></div>
              <div class="mt-3 text-sm text-slate-500">Status Koneksi: <span id="conn-status">Menghubungkan...</span></div>
            </div>

            <div class="mt-4 p-4 bg-white rounded-xl">
              <h4 class="font-semibold">Hasil Kuis</h4>
              <div id="quiz-result-panel" class="mt-2 text-sm text-slate-600">Belum ada hasil.</div>
            </div>
          </aside>
        </div>
      </section>

      <!-- PROFILE simple -->
      <section id="profile-page" class="page hidden card mt-6">
        <h2 class="text-lg font-bold">Profil</h2>
        <p class="text-sm text-slate-500">Riwayat skor tersimpan (jika login dengan Firebase).</p>
        <div id="profile-content" class="mt-4"></div>
      </section>

    </main>
  </div>

  <!-- Modal (simple) -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-40 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg">
      <h3 id="modal-title" class="text-lg font-bold">Judul</h3>
      <p id="modal-body" class="text-sm text-slate-600 mt-2"></p>
      <div class="mt-4 text-right">
        <button id="modal-close" class="vlab-button bg-blue-500 text-white">Tutup</button>
      </div>
    </div>
  </div>

  <script>
    // --- NAVIGATION ---
    document.querySelectorAll('.tab-button').forEach(btn=>btn.addEventListener('click',()=>{
      document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
      document.getElementById(btn.dataset.page+'-page').classList.remove('hidden');
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      // if vlab tab opened, ensure canvas resizes & redraws after layout
      if(btn.dataset.page === 'vlab'){
        setTimeout(()=>{ try{ if(window.vlabRefresh) window.vlabRefresh({autoplay:true}); }catch(e){} },120);
      }
      // persist active page to session storage
      try{ sessionStorage.setItem('pysphere_active_page', btn.dataset.page); }catch(e){}
    }));

    // --- Quiz Data: separate QUIZZES per topic ---
    function shuffleArray(arr){return arr.slice().sort(()=>Math.random()-0.5)}

    const QUIZZES = {
      getaran:[
        {type:'mcq', part:'Getaran & Gelombang', q:'Gelombang longitudinal memiliki getaran pada arah?', options:['Sejajar arah rambat','Tegak lurus arah rambat','Melingkar','Mundar'], a:'Sejajar arah rambat', explanation: 'Gelombang longitudinal memiliki getaran partikel medium sejajar arah rambat gelombang, contohnya gelombang bunyi.'},
        {type:'order', part:'Getaran & Gelombang', q:'Urutkan tahap dasar analisis gelombang', items:shuffleArray(['Tentukan periode/ frekuensi','Identifikasi medium','Tuliskan persamaan gelombang','Analisis perambatan']), correct:['Identifikasi medium','Tuliskan persamaan gelombang','Tentukan periode/ frekuensi','Analisis perambatan'], explanation: 'Langkah awal biasanya mengenali medium dan sifatnya, kemudian menulis persamaan, menentukan periode/frekuensi, lalu menganalisis perambatan.'},
        {type:'short', part:'Getaran & Gelombang', q:'Satuan frekuensi (tulis singkat)', a:'Hz', explanation: 'Frekuensi diukur dalam Hertz (Hz), yaitu jumlah getaran per detik.'}
      ],
      ghs:[
        {type:'mcq', part:'GHS', q:'Pada GHS ideal, periode T bergantung pada?', options:['Amplitudo','Massa dan konstanta pegas','Hanya massa','Warna pegas'], a:'Massa dan konstanta pegas', explanation: 'Periode GHS pada pegas tergantung pada massa m dan konstanta pegas k: T = 2œÄ‚àö(m/k).'},
        {type:'order', part:'GHS', q:'Urutkan turunan dari simpangan untuk mendapatkan percepatan', items:shuffleArray(['y(t)','v(t)','a(t)']), correct:['y(t)','v(t)','a(t)'], explanation: 'Percepatan adalah turunan kedua dari posisi y(t): y ‚Üí v (turunan pertama) ‚Üí a (turunan kedua).'},
        {type:'short', part:'GHS', q:'Tuliskan simbol konstanta pegas', a:'k', explanation: 'Konstanta pegas biasanya dilambangkan dengan huruf k dalam hukum Hooke.'}
      ],
      bandul:[
        {type:'mcq', part:'Bandul', q:'Periode bandul ideal bergantung pada?', options:['Massa','Panjang tali','Amplitudo besar','Warna'], a:'Panjang tali', explanation: 'Untuk bandul sederhana pada sudut kecil, periode bergantung pada panjang tali L dan percepatan gravitasi g: T = 2œÄ‚àö(L/g).'},
        {type:'order', part:'Bandul', q:'Urutkan analisis bandul untuk menemukan periode', items:shuffleArray(['Tuliskan gaya tangensial','Linearize untuk sudut kecil','Tulis persamaan gerak','Hitung perioda']), correct:['Tuliskan gaya tangensial','Tulis persamaan gerak','Linearize untuk sudut kecil','Hitung perioda'], explanation: 'Analisis bandul dimulai dari gaya tangensial, menuliskan persamaan gerak, melakukan linearization untuk sudut kecil, lalu menghitung periode.'},
        {type:'short', part:'Bandul', q:'Satuan periode T (singkat)', a:'s', explanation: 'Periode diukur dalam satuan waktu, yaitu detik (s).'}
      ],
      pegas:[
        {type:'mcq', part:'Pegas', q:'Hukum Hooke menyatakan gaya berbanding lurus dengan?', options:['Kecepatan','Percepatan','Perubahan panjang Œîx','Massa'], a:'Perubahan panjang Œîx', explanation: 'Hukum Hooke menyatakan F = -k Œîx, jadi gaya berbanding lurus dengan perubahan panjang pegas Œîx.'},
        {type:'order', part:'Pegas', q:'Urutkan langkah analisis pegas: dari gaya ke periode', items:shuffleArray(['Tentukan gaya pemulih','Tulis persamaan gerak','Cari solusi harmonik','Hitung T']), correct:['Tentukan gaya pemulih','Tulis persamaan gerak','Cari solusi harmonik','Hitung T'], explanation: 'Analisis dimulai dari gaya pemulih (Hooke), menulis persamaan gerak, mencari solusi harmonik, lalu menghitung periode.'},
        {type:'short', part:'Pegas', q:'Jika k=10 N/m dan m=1 kg, berapa œâ (rad/s)? (angka saja)', a:(Math.sqrt(10/1)).toFixed(3), explanation: 'Untuk pegas, œâ = ‚àö(k/m). Dengan k=10 dan m=1, œâ ‚âà ‚àö10 ‚âà 3.162.'}
      ]
    };

    // Create per-topic quiz controllers (4 independent sections)
    const TOPICS = ['getaran','ghs','bandul','pegas'];

    function shuffleArray(arr){ return arr.slice().sort(()=>Math.random()-0.5); } // local helper (reuse safe)

    function makeQuizController(topic){
      const qdata = QUIZZES[topic] ? QUIZZES[topic].slice() : [];
      const storageKey = 'pysphere_quiz_' + topic;
      let idx = 0; let answersLocal = Array(qdata.length).fill(null); let timerId = null; let tleft = 120; let running=false;
      const container = document.getElementById('question-container-'+topic);
      const nav = document.getElementById('question-nav-'+topic);
      const timerEl = document.getElementById('timer-'+topic);

      // load persisted answers if available
      function loadPersist(){ try{ const raw = sessionStorage.getItem(storageKey); if(raw){ const parsed = JSON.parse(raw); if(Array.isArray(parsed)) answersLocal = parsed.concat([]).slice(0, qdata.length); } }catch(e){} }
      function persist(){ try{ sessionStorage.setItem(storageKey, JSON.stringify(answersLocal)); }catch(e){} updateNavAnswered(); }

      function updateTimerDisplay(){ if(timerEl) timerEl.textContent = `${String(Math.floor(tleft/60)).padStart(2,'0')}:${String(tleft%60).padStart(2,'0')}` }

      function updateNavAnswered(){ if(!nav) return; Array.from(nav.children).forEach((b,i)=>{ if(answersLocal[i] !== null && answersLocal[i] !== undefined && answersLocal[i] !== '') b.style.background = '#dcfce7'; else b.style.background = ''; }); }

      function renderNav(){ if(!nav) return; nav.innerHTML=''; qdata.forEach((_,i)=>{ const b=document.createElement('button'); b.className='px-2 py-1 border mr-1'; b.textContent=(i+1); b.addEventListener('click',()=> goto(i)); nav.appendChild(b); }); highlightNav(); updateNavAnswered(); }
      function highlightNav(){ if(!nav) return; Array.from(nav.children).forEach((b,i)=> b.style.opacity = i===idx ? '1' : '0.6'); }

      function goto(i){ idx=i; renderQuestion(); highlightNav(); }

      function makeQuestionCard(q, i, showAll){
        const card = document.createElement('div');
        card.className = 'question-card p-4 bg-white rounded-xl mb-3';
        card.id = `q-${topic}-${i}`;
        let html = '';
        html += `<div class="flex justify-between items-center"><div><div class="text-sm text-slate-500">Bagian: ${q.part||''}</div><h3 class="font-semibold text-slate-800">Soal ${i+1} / ${qdata.length}</h3></div>`;
        if(!showAll) html += `<div><button id='prev-${topic}' class='vlab-button bg-white border mr-2'>Sebelumnya</button><button id='next-${topic}' class='vlab-button bg-blue-500 text-white'>Selanjutnya</button></div>`;
        html += `</div><div class='mt-3'><p class='text-slate-700'>${q.q}</p>`;
        if(q.type==='mcq'){
          html += `<div class='mt-3 space-y-2'>`;
          (q.options||[]).forEach(opt=> html += `<label class='flex items-center gap-2 p-2 rounded-md'><input type='radio' name='ans-${topic}-${i}' value='${opt}' /> <span>${opt}</span></label>`);
          html += `</div>`;
        } else if(q.type==='order'){
          html += `<div class='mt-3'><ul id='order-list-${topic}-${i}' class='ordering-list'>`;
          (q.items||[]).forEach(it=> html += `<li class='ordering-item' draggable='true'>${it}</li>`);
          html += `</ul><div class='mt-2 text-xs text-slate-500'>Seret untuk menyusun kembali urutan.</div>`;
          // show a Save button only for the second question (index 1) as requested
          html += `${i === 1 ? `<div class='mt-2'><button id='save-ans-${topic}-${i}' class='vlab-button bg-green-500 text-white'>Simpan Jawaban</button></div>` : ''}`;
          html += `</div>`;
        } else {
          html += `<div class='mt-3'><input id='short-answer-${topic}-${i}' class='w-full p-2 border rounded-md' placeholder='Jawaban singkat...' /></div>`;
        }
        // explanation area (hidden until grading)
        html += `<div class='mt-2 text-sm text-slate-700 explanation' style='display:none'><strong>Pembahasan:</strong> ${q.explanation || ''}</div>`;
  if(!showAll) html += `</div><div class='mt-3 flex gap-2'><button id='sol-${topic}' class='vlab-button bg-white border'>Pembahasan</button></div>`;
        card.innerHTML = html;

        // attach interactions
        if(!showAll){
          const prevBtn = card.querySelector('#prev-'+topic);
          const nextBtn = card.querySelector('#next-'+topic);
          if(prevBtn) prevBtn.addEventListener('click', ()=>{ if(idx>0) goto(idx-1); });
          if(nextBtn) nextBtn.addEventListener('click', ()=>{ if(idx < qdata.length-1) goto(idx+1); });
          // note: explicit save button removed; answers autosave on input/change
        }

        // restore saved answer for this index
        const prev = answersLocal[i];
        if(q.type==='mcq'){
          const inputs = card.querySelectorAll(`input[type=radio]`);
          inputs.forEach(inp=>{
            if(prev !== null && prev !== undefined && String(prev) === String(inp.value)) inp.checked = true;
            inp.addEventListener('change', (e)=>{ answersLocal[i] = e.target.value; persist(); updateGlobalScore(); });
          });
        } else if(q.type==='short'){
          const sa = card.querySelector(`#short-answer-${topic}-${i}`);
          if(sa){ sa.value = prev || ''; sa.addEventListener('input', e=>{ answersLocal[i] = e.target.value; persist(); updateGlobalScore(); }); }
        } else if(q.type==='order'){
          const list = card.querySelector(`#order-list-${topic}-${i}`);
          // restore ordering if present
          if(list && prev && Array.isArray(prev) && prev.length){ list.innerHTML = ''; prev.forEach(it=>{ const li = document.createElement('li'); li.className='ordering-item'; li.draggable=true; li.textContent=it; list.appendChild(li); }); }
          if(list){ let drag=null; list.querySelectorAll('.ordering-item').forEach(it=>{ it.addEventListener('dragstart',()=>{ drag=it; it.style.opacity=0.6}); it.addEventListener('dragend',()=>{ drag=null; it.style.opacity=1; persist(); updateGlobalScore(); }); it.addEventListener('dragover',e=>{ e.preventDefault(); if(drag!==it) list.insertBefore(drag,it); }); });
            // wire the explicit save button for this ordering question (if present)
            const saveBtn = card.querySelector(`#save-ans-${topic}-${i}`);
            if(saveBtn){ saveBtn.addEventListener('click', ()=>{
              const items = list.querySelectorAll('.ordering-item');
              const arr = Array.from(items).map(li=> li.textContent);
              answersLocal[i] = arr;
              persist(); updateGlobalScore();
              // disable after saving to indicate persistence
              saveBtn.disabled = true; saveBtn.textContent = 'Tersimpan';
            });
            // if we already have a saved ordering, disable the save button
            if(answersLocal[i] && Array.isArray(answersLocal[i]) && answersLocal[i].length){ saveBtn.disabled = true; saveBtn.textContent = 'Tersimpan'; }
          }
          }
        }

        return card;
      }

      function renderQuestion(){ if(!container) return; container.innerHTML = ''; const q = qdata[idx] || {type:'short', q:'Tidak ada soal'}; const card = makeQuestionCard(q, idx, false); container.appendChild(card); }

      function renderAllQuestions(){ if(!container) return; container.innerHTML = ''; qdata.forEach((q,i)=> container.appendChild(makeQuestionCard(q,i,true))); }

      function saveAnswer(i){ const q = qdata[i]; if(!q) return; if(q.type==='mcq'){ const sel = container.querySelector(`input[name=ans-${topic}-${i}]:checked`) || container.querySelector(`input[name=ans-${topic}-${i}]`); answersLocal[i] = sel ? sel.value : null; } else if(q.type==='short'){ const el = container.querySelector('#short-answer-'+topic+'-'+i); answersLocal[i] = el ? el.value.trim() : ''; } else { const list = container.querySelectorAll('.ordering-item'); answersLocal[i] = Array.from(list).map(li=>li.textContent); } persist(); updateGlobalScore(); }

      function computeScore(){ let s=0; qdata.forEach((q,i)=>{ const a = answersLocal[i]; if(a===null || a===undefined || a==='') return; if(q.type==='mcq' && String(a)===String(q.a)) s++; else if(q.type==='short' && String(a).toLowerCase()===String(q.a).toLowerCase()) s++; else if(q.type==='order' && JSON.stringify(a)===JSON.stringify(q.correct)) s++; }); const percent = Math.round(100 * s / qdata.length); return {score:s, max:qdata.length, percent}; }

      function start(){ if(running) return; running=true; loadPersist(); updateNavAnswered(); tleft=120; updateTimerDisplay(); if(timerId) clearInterval(timerId); timerId = setInterval(()=>{ tleft--; if(tleft<=0){ clearInterval(timerId); running=false; finish(); } updateTimerDisplay(); },1000); renderNav(); renderQuestion();
        // wire submit button
        const submitBtn = document.querySelector(`.submit-topic[data-topic='${topic}']`);
        if(submitBtn){ submitBtn.onclick = ()=>{ finish(); } }
      }

      function finish(){ // grade now, stop timer and reveal explanations and colored markings
        // ensure latest inputs persisted
        try{ persist(); }catch(e){}
        if(timerId) clearInterval(timerId); running=false;
        // render all so explanations & inputs are present
        renderAllQuestions();
        qdata.forEach((q,i)=>{
          const card = document.getElementById(`q-${topic}-${i}`);
          if(!card) return;
          const explain = card.querySelector('.explanation');
          let correct = false; const a = answersLocal[i];
          if(q.type==='mcq' && String(a)===String(q.a)) correct = true;
          if(q.type==='short' && a && String(a).toLowerCase()===String(q.a).toLowerCase()) correct = true;
          if(q.type==='order' && JSON.stringify(a)===JSON.stringify(q.correct)) correct = true;
          // mark
          if(correct){ card.classList.add('q-correct'); card.classList.remove('q-wrong'); } else { card.classList.add('q-wrong'); card.classList.remove('q-correct'); }
          // reveal explanation
          if(explain) explain.style.display = 'block';
          // disable inputs to prevent further edits after submit
          const inputs = card.querySelectorAll('input'); inputs.forEach(inp=> inp.disabled = true);
          // disable drag interactions for ordering questions
          const items = card.querySelectorAll('.ordering-item'); items.forEach(it=>{ it.draggable = false; it.style.cursor = 'default'; });
        });
        const res = computeScore();
        const panel = document.getElementById('quiz-result-panel');
        if(panel) panel.innerHTML = `<div class='font-bold'>Skor Anda: ${res.percent} / 100</div><div class='text-sm mt-1'>(${res.score} benar dari ${res.max} soal)</div>`;
        if(timerEl) timerEl.textContent = `Skor: ${res.percent}/100`;
        persist(); updateGlobalScore();
        // optionally, disable the submit button to prevent re-submission
        const submitBtn = document.querySelector(`.submit-topic[data-topic='${topic}']`);
        if(submitBtn) submitBtn.disabled = true;
        // mark topic as finished (persist a small flag)
        try{ sessionStorage.setItem('pysphere_quiz_finished_'+topic, '1'); }catch(e){}
        // update this topic UI (show per-topic score inside panel)
        try{ if(window.updateTopicUI) window.updateTopicUI(topic); }catch(e){}
        // refresh the completed quizzes list panel
        try{ if(window.renderCompletedResults) window.renderCompletedResults(); }catch(e){}
      }

      function review(){ console.table(answersLocal); alert('Rangkuman jawaban untuk '+topic+' ditampilkan di konsol (developer).'); }

      // show explanations by rendering all questions and revealing explanation blocks
      function showExplanations(){ renderAllQuestions(); // reveal explanation blocks
        setTimeout(()=>{ qdata.forEach((q,i)=>{ const card = document.getElementById(`q-${topic}-${i}`); if(card) { const exp = card.querySelector('.explanation'); if(exp) exp.style.display = 'block'; } }); }, 40);
      }

      function retry(){ if(timerId) clearInterval(timerId); sessionStorage.removeItem(storageKey); try{ sessionStorage.removeItem('pysphere_quiz_finished_'+topic); }catch(e){} answersLocal = Array(qdata.length).fill(null); idx=0; tleft=120; running=false; renderNav(); renderQuestion(); updateGlobalScore(); try{ if(window.updateTopicUI) window.updateTopicUI(topic); }catch(e){} }

      // initialize by loading saved answers
      loadPersist();

      return { start, review, retry, computeScore, renderNav };
    }

    const CONTROLLERS = {};
    TOPICS.forEach(t=>{
      CONTROLLERS[t] = makeQuizController(t);
      // start-topic now navigates within the same tab by setting a hash like #take-<topic>
      document.querySelectorAll(`button.start-topic[data-topic='${t}']`).forEach(b=> b.addEventListener('click', ()=>{
        // set hash to trigger isolated quiz view in the same tab
        try{ location.hash = `take-${t}`; window.scrollTo(0,0); }catch(e){ /* fallback no-op */ }
      }));
      document.querySelectorAll(`button.review-topic[data-topic='${t}']`).forEach(b=> b.addEventListener('click', ()=> CONTROLLERS[t].review()));
      document.querySelectorAll(`button.retry-topic[data-topic='${t}']`).forEach(b=> b.addEventListener('click', ()=> CONTROLLERS[t].retry()));
      CONTROLLERS[t].renderNav();
    });

    // If page loaded with a hash like #take-<topic>, go into isolated quiz-taking mode for that topic
    // Handle starting an isolated quiz when hash is set to #take-<topic>
    function handleHashStart(){
      try{
        const h = (location.hash||'').replace('#','');
        // cleanup any prior injected back control
        const priorBack = document.getElementById('close-quiz');
        if(priorBack){ const wrapper = priorBack.parentElement; if(wrapper) wrapper.remove(); }

        if(h.startsWith('take-')){
          const topic = h.split('take-')[1];
          if(TOPICS.includes(topic)){
            // hide everything else and show only quiz page and that topic panel
            document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
            const quizPage = document.getElementById('quiz-page'); if(quizPage) quizPage.classList.remove('hidden');
            // hide other topic panels and only display focused topic
            document.querySelectorAll('#quiz-sections > div').forEach(d=> d.classList.add('hidden'));
            const panel = document.getElementById('quiz-'+topic);
            if(panel) panel.classList.remove('hidden');
            // add a small back control that restores the previous view instead of closing the tab
            const back = document.createElement('div'); back.className='p-4'; back.innerHTML = `<button id='close-quiz' class='vlab-button bg-gray-200 border'>Selesai & Kembali</button>`;
            const quizPageEl = document.getElementById('quiz-page'); if(quizPageEl) quizPageEl.insertBefore(back, quizPageEl.firstChild);
            const closeBtn = document.getElementById('close-quiz');
            if(closeBtn){
              closeBtn.addEventListener('click', ()=>{
                try{
                  // clear hash which triggers handler to restore view
                  location.hash = '';
                }catch(e){
                  // fallback: restore UI directly
                  const last = sessionStorage.getItem('pysphere_active_page') || 'materi';
                  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
                  const tabBtn = Array.from(document.querySelectorAll('.tab-button')).find(b=>b.dataset.page===last);
                  if(tabBtn){ tabBtn.click(); } else { const m = document.getElementById('materi-page'); if(m) m.classList.remove('hidden'); }
                }
              });
            }
            // auto-start controller for that topic
            setTimeout(()=>{ try{ CONTROLLERS[topic].start(); }catch(e){ console.warn(e); } }, 120);
            return;
          }
        }

        // if no relevant hash, restore the last active page (or materi)
        const last = sessionStorage.getItem('pysphere_active_page') || 'materi';
        document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
        const tabBtn = Array.from(document.querySelectorAll('.tab-button')).find(b=>b.dataset.page===last);
        if(tabBtn){
          tabBtn.click();
          // if returning to the quiz page, ensure all topic panels are visible again
          if(last === 'quiz'){
            // un-hide all topic panels
            document.querySelectorAll('#quiz-sections > div').forEach(d=> d.classList.remove('hidden'));
          }
        } else {
          const m = document.getElementById('materi-page'); if(m) m.classList.remove('hidden');
        }

      }catch(e){ console.warn('hash start handling failed', e); }
    }
    // run on load and whenever the hash changes
    handleHashStart();
    window.addEventListener('hashchange', handleHashStart);

    function updateGlobalScore(){ let total=0, maxTotal=0; TOPICS.forEach(t=>{ const r = CONTROLLERS[t].computeScore(); total += r.score; maxTotal += r.max; }); document.getElementById('live-score').textContent = `${total} / ${maxTotal}`; }

    // Render a summary list of completed quizzes into the result panel
    window.renderCompletedResults = function(){
      try{
        const panel = document.getElementById('quiz-result-panel');
        if(!panel) return;
        const rows = [];
        TOPICS.forEach(t=>{
          try{
            const ctrl = CONTROLLERS[t];
            const r = ctrl.computeScore();
            // determine if any answer saved for this topic (treat as completed if at least one answer exists)
            const raw = sessionStorage.getItem('pysphere_quiz_'+t);
            const has = raw ? JSON.parse(raw).some(a=> a !== null && a !== undefined && a !== '') : false;
            if(has){
              const label = QUIZZES[t] && QUIZZES[t][0] && QUIZZES[t][0].part ? QUIZZES[t][0].part : t;
              rows.push({topic:t,label,percent:r.percent,score:r.score,max:r.max});
            }
          }catch(e){}
        });
        if(rows.length === 0){ panel.innerHTML = 'Belum ada hasil.'; return; }
        // sort by percent desc
        rows.sort((a,b)=> b.percent - a.percent);
        const html = rows.map(r=> `<div class='mb-2'><div class='font-semibold'>${r.label} ‚Äî ${r.percent} / 100</div><div class='text-sm text-slate-600'>(${r.score} benar dari ${r.max} soal)</div></div>`).join('');
        panel.innerHTML = html;
      }catch(e){ console.warn('renderCompletedResults failed', e); }
    };

    // populate initial results on load
    setTimeout(()=>{ try{ window.renderCompletedResults(); }catch(e){} }, 300);
    // update UI for a topic's panel to show its result and change controls when finished
    window.updateTopicUI = function(topic){
      try{
        const panelRes = document.getElementById('result-'+topic);
        const finished = sessionStorage.getItem('pysphere_quiz_finished_'+topic);
        const ctrl = CONTROLLERS[topic]; if(!ctrl) return;
        const r = ctrl.computeScore();
        if(finished){
          // show compact score badge inside the panel
          panelRes.classList.add('quiz-completed');
          panelRes.innerHTML = `<div class='flex items-center justify-between'><div><div class='font-semibold'>${QUIZZES[topic] && QUIZZES[topic][0] ? QUIZZES[topic][0].part : topic}</div><div class='text-sm text-slate-600'>${r.score} benar dari ${r.max} soal</div></div><div class='ml-4'><span class='completed-badge'>${r.percent}/100</span></div></div>`;
          // hide start/submit/review buttons, leave only retry visible
          document.querySelectorAll(`button.start-topic[data-topic='${topic}']`).forEach(b=> b.style.display='none');
          document.querySelectorAll(`button.submit-topic[data-topic='${topic}']`).forEach(b=> b.style.display='none');
          document.querySelectorAll(`button.review-topic[data-topic='${topic}']`).forEach(b=> b.style.display='none');
          document.querySelectorAll(`button.retry-topic[data-topic='${topic}']`).forEach(b=> { b.style.display='inline-flex'; b.textContent='Ulangi'; });
        } else {
          // not finished
          if(panelRes) panelRes.innerHTML = 'Belum dikerjakan.'; panelRes.classList.remove('quiz-completed');
          document.querySelectorAll(`button.start-topic[data-topic='${topic}']`).forEach(b=> b.style.display='inline-flex');
          document.querySelectorAll(`button.submit-topic[data-topic='${topic}']`).forEach(b=> b.style.display='inline-flex');
          document.querySelectorAll(`button.review-topic[data-topic='${topic}']`).forEach(b=> b.style.display='inline-flex');
          document.querySelectorAll(`button.retry-topic[data-topic='${topic}']`).forEach(b=> { b.style.display='inline-flex'; b.textContent='Ulangi'; });
        }
      }catch(e){ console.warn('updateTopicUI failed', e); }
    };

    // initialize topic UI states
    TOPICS.forEach(t=> setTimeout(()=>{ try{ window.updateTopicUI(t); }catch(e){} }, 200));

    // Interactive V-Lab simulation (pegas & bandul) with live outputs and CSV recording
    (function(){
      const canvas = document.getElementById('physicsCanvas');
      const ctx = canvas.getContext('2d');
      let rafId = null;
      let running = false;
      let record = false;
      const records = [];

      // state
      let mode = 'pegas'; // 'pegas' or 'bandul'
      let m = 1, k = 10, A = 0.5, L = 1, g = 9.81;
      let x = 0, v = 0, a = 0; // displacement (m) or angle (rad)
      let omega = 0, period = 0;

      const getSliders = () => {
        m = parseFloat(document.getElementById('mass-slider').value);
        k = parseFloat(document.getElementById('k-slider').value);
        A = parseFloat(document.getElementById('amp-slider').value);
        L = parseFloat(document.getElementById('length-slider').value);
        g = parseFloat(document.getElementById('g-slider').value);
      };

      const outputs = {
        mode: document.getElementById('vlab-mode-display'),
        period: document.getElementById('vlab-period'),
        omega: document.getElementById('vlab-omega'),
        pos: document.getElementById('vlab-pos'),
        vel: document.getElementById('vlab-vel'),
        acc: document.getElementById('vlab-acc'),
        ep: document.getElementById('vlab-ep'),
        ek: document.getElementById('vlab-ek'),
        et: document.getElementById('vlab-et')
      };

      const resize = () => {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = rect.width; canvas.height = rect.height;
        draw();
      };
  window.addEventListener('resize', resize);
  resize();

      // draw simple visualization
      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const W = canvas.width, H = canvas.height;
        const cx = W/2;
        if(mode === 'pegas'){
          const equilibriumY = H/2 - 60;
          const blockY = equilibriumY + x*120;
          // draw a coiled spring (sinusoidal zig-zag) from pivot to top of block
          const springTopY = 20;
          const springBottomY = blockY;
          const springHeight = Math.max(16, springBottomY - springTopY);
          const coils = 12; // number of visible coils
          const coilWidth = 30; // horizontal amplitude of coil
          ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.beginPath();
          // start at pivot
          ctx.moveTo(cx, springTopY);
          for(let i=0;i<=coils;i++){
            const t = i / coils;
            // y along the spring
            const y = springTopY + t * springHeight;
            // alternate left/right x using sin wave
            const angle = t * Math.PI * coils;
            const sx = cx + Math.sin(angle) * coilWidth * (1 - t*0.6); // taper slightly
            ctx.lineTo(sx, y);
          }
          ctx.lineTo(cx, springBottomY);
          ctx.stroke();

          // block
          ctx.fillStyle = '#f97316'; ctx.fillRect(cx-50, blockY, 100, 40);
          ctx.fillStyle = '#fff'; ctx.font='16px Inter'; ctx.textAlign='center'; ctx.fillText('M='+m.toFixed(2)+' kg', cx, blockY+28);
        } else {
          const pivotX = cx, pivotY = 40;
          const scaledL = Math.min(H*0.6, L*200);
          const bobX = pivotX + scaledL * Math.sin(x);
          const bobY = pivotY + scaledL * Math.cos(x);
          ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(pivotX,pivotY); ctx.lineTo(bobX,bobY); ctx.stroke();
          ctx.fillStyle = '#ef4444'; ctx.beginPath(); ctx.arc(bobX,bobY,20,0,Math.PI*2); ctx.fill();
        }
      }

      // physics update with simple Euler
      const dt = 0.016; // ~60Hz
      function step(){
        getSliders();
        if(mode === 'pegas'){
          omega = Math.sqrt(k / m);
          period = 2*Math.PI/omega;
          a = (-k * x) / m;
          v += a * dt;
          x += v * dt;
          const EP = 0.5 * k * x * x;
          const EK = 0.5 * m * v * v;
          const ET = EP + EK;
          // outputs
          outputs.mode.textContent = 'Pegas';
          outputs.period.textContent = period.toFixed(3);
          outputs.omega.textContent = omega.toFixed(3);
          outputs.pos.textContent = x.toFixed(3) + ' m';
          outputs.vel.textContent = v.toFixed(3) + ' m/s';
          outputs.acc.textContent = a.toFixed(3) + ' m/s¬≤';
          outputs.ep.textContent = EP.toFixed(3);
          outputs.ek.textContent = EK.toFixed(3);
          outputs.et.textContent = ET.toFixed(3);
          if(record) records.push({t:performance.now(),mode,x,v,a,EP,EK,ET});
        } else {
          // bandul
          omega = Math.sqrt(g / L);
          period = 2*Math.PI/omega;
          const alpha = - (g / L) * Math.sin(x);
          v += alpha * dt;
          x += v * dt;
          const y_height = L * (1 - Math.cos(x));
          const v_linear = v * L;
          const EP = 1 * g * y_height; // assume m_bob =1
          const EK = 0.5 * v_linear * v_linear;
          const ET = EP + EK;
          outputs.mode.textContent = 'Bandul';
          outputs.period.textContent = period.toFixed(3);
          outputs.omega.textContent = omega.toFixed(3);
          outputs.pos.textContent = (x * 180/Math.PI).toFixed(2) + ' ¬∞';
          outputs.vel.textContent = v_linear.toFixed(3) + ' m/s';
          outputs.acc.textContent = (alpha*L).toFixed(3) + ' m/s¬≤';
          outputs.ep.textContent = EP.toFixed(3);
          outputs.ek.textContent = EK.toFixed(3);
          outputs.et.textContent = ET.toFixed(3);
          if(record) records.push({t:performance.now(),mode,x,v,alpha,EP,EK,ET});
        }

        draw();
        if(running) rafId = requestAnimationFrame(step);
      }

      // control handlers
      document.getElementById('vlab-start').addEventListener('click', ()=>{
        if(!running){
          // init state
          mode = document.getElementById('mode-pegas').classList.contains('bg-blue-500') ? 'pegas' : 'bandul';
          getSliders();
          x = (mode === 'pegas') ? A : (document.getElementById('theta-slider').value * Math.PI/180);
          v = 0; a = 0;
          running = true; record = false;
          rafId = requestAnimationFrame(step);
        }
      });

      document.getElementById('vlab-pause').addEventListener('click', ()=>{
        if(running){ running = false; if(rafId) cancelAnimationFrame(rafId); }
      });

      document.getElementById('vlab-reset').addEventListener('click', ()=>{
        running = false; record = false; records.length = 0; if(rafId) cancelAnimationFrame(rafId);
        x = 0; v = 0; a = 0; outputs.pos.textContent='--'; outputs.vel.textContent='--'; outputs.acc.textContent='--'; outputs.ep.textContent='--'; outputs.ek.textContent='--'; outputs.et.textContent='--'; outputs.period.textContent='--'; outputs.omega.textContent='--'; draw();
      });

      document.getElementById('vlab-record').addEventListener('click', ()=>{
        record = !record; document.getElementById('vlab-record').textContent = record ? 'Berhenti Rekam' : 'Rekam';
        if(record) records.length = 0;
      });

      document.getElementById('vlab-download').addEventListener('click', ()=>{
        if(records.length === 0){ alert('Tidak ada data untuk diunduh.'); return; }
        const keys = Object.keys(records[0]);
        const csv = [keys.join(',')].concat(records.map(r => keys.map(k => r[k]).join(','))).join('\n');
        const blob = new Blob([csv], {type:'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'vlab-records.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      // mode toggle buttons (also update display)
      // Expose API to set mode from outside (control wiring will call this)
      window.vlabSetMode = function(m){
        try{ mode = m; outputs.mode.textContent = (m === 'pegas') ? 'Pegas' : 'Bandul'; }catch(e){ console.warn('vlabSetMode failed', e); }
      };

      // initial draw
      draw();

      // expose a refresh API so navigation can trigger resize/redraw when the VLab becomes visible
      window.vlabRefresh = function(opts){
        try{
          resize(); draw();
          if(opts && opts.autoplay){
            // brief demo run: start for 3s then pause
            running = true; if(rafId) cancelAnimationFrame(rafId); rafId = requestAnimationFrame(step);
            setTimeout(()=>{ running = false; if(rafId) cancelAnimationFrame(rafId); }, 3000);
          }
        }catch(e){ console.warn('vlabRefresh failed', e); }
      };
    })();

    // connection status mock
    setTimeout(()=>{ document.getElementById('conn-status').textContent='Terhubung (offline-mode)'; },1200);

    // init: show materi page
    // try to restore last active page and materi module from sessionStorage
    (function restoreActiveView(){
      try{
        const page = sessionStorage.getItem('pysphere_active_page') || 'materi';
        const moduleId = sessionStorage.getItem('pysphere_active_module');
        // simulate click on matching tab-button so existing handlers run
        const tabBtn = Array.from(document.querySelectorAll('.tab-button')).find(b=>b.dataset.page===page);
        if(tabBtn){ tabBtn.click(); }
        // if moduleId exists and we're on materi, click module button after a short delay
        if(moduleId && page==='materi'){
          setTimeout(()=>{ const mbtn = Array.from(document.querySelectorAll('.materi-link')).find(b=>b.dataset.target===moduleId); if(mbtn) mbtn.click(); }, 160);
        }
      }catch(e){ document.getElementById('materi-page').classList.remove('hidden'); }
    })();

    // --- VLab controls wiring: show/hide control groups & slider displays ---
    (function(){
      const pegasControls = document.querySelector('.pegas-controls');
      const bandulControls = document.querySelector('.bandul-controls');
      const modePegasBtn = document.getElementById('mode-pegas');
      const modeBandulBtn = document.getElementById('mode-bandul');

      function setModeUI(m){
        const isPegas = (m === 'pegas');
        // show/hide controls
        pegasControls.classList.toggle('hidden', !isPegas);
        bandulControls.classList.toggle('hidden', isPegas);
        // Active button styling (pill): bg-blue-500, text-white, remove border
        if(isPegas){
          modePegasBtn.classList.add('bg-blue-500','text-white'); modePegasBtn.classList.remove('bg-white','text-slate-700','border');
          modeBandulBtn.classList.remove('bg-blue-500','text-white'); modeBandulBtn.classList.add('bg-white','text-slate-700','border');
        } else {
          modeBandulBtn.classList.add('bg-blue-500','text-white'); modeBandulBtn.classList.remove('bg-white','text-slate-700','border');
          modePegasBtn.classList.remove('bg-blue-500','text-white'); modePegasBtn.classList.add('bg-white','text-slate-700','border');
        }
        document.getElementById('vlab-mode-label').textContent = isPegas ? 'Pegas' : 'Bandul';
        // call simulation API and refresh view
        if(window.vlabSetMode) try{ window.vlabSetMode(isPegas ? 'pegas' : 'bandul'); }catch(e){console.warn(e)}
        try{ if(window.vlabRefresh) window.vlabRefresh(); }catch(e){}
      }

      modePegasBtn.addEventListener('click', ()=> setModeUI('pegas'));
      modeBandulBtn.addEventListener('click', ()=> setModeUI('bandul'));

      // slider displays
      const mVal = document.getElementById('m-val'); const kVal = document.getElementById('k-val'); const aVal = document.getElementById('a-val');
      const LVal = document.getElementById('L-val'); const gVal = document.getElementById('g-val'); const thetaVal = document.getElementById('theta-val');

      document.getElementById('mass-slider').addEventListener('input', e=>{ mVal.textContent = parseFloat(e.target.value).toFixed(2); });
      document.getElementById('k-slider').addEventListener('input', e=>{ kVal.textContent = parseFloat(e.target.value).toFixed(2); });
      document.getElementById('amp-slider').addEventListener('input', e=>{ aVal.textContent = parseFloat(e.target.value).toFixed(2); });
      document.getElementById('length-slider').addEventListener('input', e=>{ LVal.textContent = parseFloat(e.target.value).toFixed(2); });
      document.getElementById('g-slider').addEventListener('input', e=>{ gVal.textContent = parseFloat(e.target.value).toFixed(2); });
      document.getElementById('theta-slider').addEventListener('input', e=>{ thetaVal.textContent = parseInt(e.target.value,10); });

      // start/reset buttons (also forward events to vlab handlers via ids)
      document.getElementById('start-btn').addEventListener('click', ()=>document.getElementById('vlab-start').click());
      document.getElementById('reset-btn').addEventListener('click', ()=>document.getElementById('vlab-reset').click());

      // ensure initial UI state: show pegas by default
      setModeUI('pegas');
    })();

    /*** MODULES: sidebar navigation + progress (in-memory/session) ***/
    // ensure DOM ready for new materi elements
    (function(){
      const MODULES = ['getaran','ghs','bandul','pegas'];

      // in-memory state only: will reset on refresh
      let state = {}; // { moduleId: true }

      const updateProgressUI = () => {
        const readCount = MODULES.filter(m => state[m]).length;
        const percent = Math.round((readCount / MODULES.length) * 100);
        document.getElementById('materi-progress-fill').style.width = percent + '%';
        document.getElementById('materi-progress-percent').textContent = percent + '%';
      };

      const refreshButtons = () => {
        document.querySelectorAll('.mark-read').forEach(btn=>{
          const mod = btn.dataset.module;
          if(state[mod]){
            btn.textContent = 'Sudah Dibaca';
            btn.disabled = true;
            btn.classList.remove('bg-blue-600');
            btn.classList.add('bg-gray-400','cursor-not-allowed');
          } else {
            btn.textContent = 'Tandai Dibaca';
            btn.disabled = false;
            btn.classList.remove('bg-gray-400','cursor-not-allowed');
            btn.classList.add('bg-blue-600');
          }
        });
      };

      // sidebar navigation: show only selected module and mark active button
      const materiButtons = Array.from(document.querySelectorAll('.materi-link'));
      const moduleArticles = MODULES.map(id => document.getElementById(id));

      const showModule = (id) => {
        moduleArticles.forEach(a=>{ if(!a) return; a.classList.add('module-hidden'); });
        const targetEl = document.getElementById(id);
        if(targetEl) targetEl.classList.remove('module-hidden');
        materiButtons.forEach(b=>{ if(b.dataset.target === id){ b.classList.add('bg-yellow-300'); b.classList.add('tab-active'); } else { b.classList.remove('bg-yellow-300'); b.classList.remove('tab-active'); } });
        // update focus
        if(targetEl) targetEl.scrollIntoView({behavior:'smooth', block:'start'});
      };

      materiButtons.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          showModule(btn.dataset.target);
          try{ sessionStorage.setItem('pysphere_active_module', btn.dataset.target); }catch(e){}
        });
      });

      // on load: hide all then show first module
      (function initModuleView(){
        moduleArticles.forEach(a=>{ if(a) a.classList.add('module-hidden'); });
        showModule(MODULES[0]);
      })();

      // mark-read handlers (in-memory only)
      document.querySelectorAll('.mark-read').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mod = btn.dataset.module;
          state[mod] = true;
          updateProgressUI();
          refreshButtons();
        });
      });

      // clear in-memory state when navigating away via navbar
      document.querySelectorAll('.tab-button').forEach(tab=>{
        tab.addEventListener('click', ()=>{
          // if user navigates to a page other than 'materi', reset marks
          if(tab.dataset.page && tab.dataset.page !== 'materi'){
            state = {};
            updateProgressUI();
            refreshButtons();
          }
        });
      });

      // init
      updateProgressUI();
      refreshButtons();
    })();
  </script>

</body>
</html>
