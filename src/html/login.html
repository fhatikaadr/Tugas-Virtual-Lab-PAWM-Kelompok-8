<!DOCTYPE html>
<html lang="id">
<head>
  <script src="/src/js/supabase-client.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhySphere — Login & Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/css/style.css">
</head>
<body class="auth-body min-h-screen">
  <!-- Container dengan Layout Split -->
  <div class="min-h-screen grid lg:grid-cols-2 gap-0">
    
    <!-- LEFT SIDE - Form Card -->
    <div class="flex items-center justify-center p-6 lg:p-12 relative z-10">
      <div class="w-full max-w-md">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl p-8 lg:p-10">
          
          <!-- Physics Logo with Orbits -->
          <div class="physics-logo mb-6">
            <div class="physics-orbit" style="width:80px;height:80px;">
              <div class="physics-electron"></div>
            </div>
            <div class="physics-orbit" style="width:80px;height:80px;transform:rotate(60deg);">
              <div class="physics-electron"></div>
            </div>
            <div class="physics-orbit" style="width:80px;height:80px;transform:rotate(120deg);">
              <div class="physics-electron"></div>
            </div>
            <div class="physics-nucleus"></div>
          </div>
          
          <h1 class="text-3xl lg:text-4xl font-extrabold text-center mb-2 bg-gradient-to-r from-purple-600 via-purple-500 to-amber-500 bg-clip-text text-transparent">PhySphere</h1>
          <p class="text-center text-slate-600 mb-8">Masuk ke portal pembelajaran fisika interaktif</p>
          
          <!-- Tab Switcher -->
          <div class="auth-tabs mb-6">
            <button class="auth-tab active" data-tab="login">Masuk</button>
            <button class="auth-tab" data-tab="register">Daftar</button>
          </div>
          
          <!-- Login Form -->
          <div id="login-container" class="auth-form-container active">
            <form id="login-form" class="space-y-4">
              <div>
                <label class="auth-label">📧 Email Address</label>
                <input 
                  id="login-email" 
                  type="email" 
                  class="auth-input" 
                  placeholder="nama@email.com"
                  required
                >
              </div>
              
              <div>
                <label class="auth-label">🔐 Password</label>
                <input 
                  id="login-password" 
                  type="password" 
                  class="auth-input" 
                  placeholder="••••••••"
                  required
                >
              </div>
              
              <div id="login-msg" class="auth-msg text-red-600"></div>
              
              <button type="submit" class="auth-btn auth-btn-primary w-full">
                Masuk
              </button>
            </form>
            
            <div class="mt-5 text-center">
              <div class="relative">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-slate-200"></div>
                </div>
                <div class="relative flex justify-center text-xs">
                  <span class="px-3 bg-white text-slate-500">atau masuk dengan</span>
                </div>
              </div>
            </div>
            
            <button type="button" id="google-login" class="mt-5 w-full flex items-center justify-center gap-3 px-4 py-3 border-2 border-slate-200 rounded-xl font-semibold text-slate-700 hover:bg-slate-50 hover:border-slate-300 transition-all">
              <svg class="w-5 h-5" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              Masuk dengan Google
            </button>
          </div>
          
          <!-- Register Form -->
          <div id="register-container" class="auth-form-container">
            <form id="register-form" class="space-y-4">
              <div>
                <label class="auth-label">👤 Nama Lengkap</label>
                <input 
                  id="reg-name" 
                  type="text" 
                  class="auth-input" 
                  placeholder="Nikola Tesla"
                  required
                >
              </div>
              
              <div>
                <label class="auth-label">📧 Email Address</label>
                <input 
                  id="reg-email" 
                  type="email" 
                  class="auth-input" 
                  placeholder="nama@email.com"
                  required
                >
              </div>
              
              <div>
                <label class="auth-label">🔐 Password</label>
                <input 
                  id="reg-password" 
                  type="password" 
                  class="auth-input" 
                  placeholder="••••••••"
                  required
                >
              </div>
              
              <div id="reg-msg" class="auth-msg text-red-600"></div>
              
              <button type="submit" class="auth-btn auth-btn-primary w-full">
                Daftar Sekarang
              </button>
            </form>
            
            <div class="mt-5 text-center">
              <div class="relative">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-slate-200"></div>
                </div>
                <div class="relative flex justify-center text-xs">
                  <span class="px-3 bg-white text-slate-500">atau daftar dengan</span>
                </div>
              </div>
            </div>
            
            <button type="button" id="google-register" class="mt-5 w-full flex items-center justify-center gap-3 px-4 py-3 border-2 border-slate-200 rounded-xl font-semibold text-slate-700 hover:bg-slate-50 hover:border-slate-300 transition-all">
              <svg class="w-5 h-5" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              Daftar dengan Google
            </button>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- RIGHT SIDE - Physics Visualization -->
    <div class="hidden lg:flex items-center justify-center p-12 relative">
      <!-- Animated particles in background -->
      <div class="physics-particle" style="width:150px;height:150px;top:10%;left:10%;--tx:100px;--ty:-80px;animation-delay:0s;"></div>
      <div class="physics-particle" style="width:120px;height:120px;top:30%;right:15%;--tx:-90px;--ty:120px;animation-delay:4s;"></div>
      <div class="physics-particle" style="width:100px;height:100px;bottom:20%;left:20%;--tx:110px;--ty:-100px;animation-delay:8s;"></div>
      <div class="physics-particle" style="width:130px;height:130px;bottom:35%;right:10%;--tx:-80px;--ty:90px;animation-delay:12s;"></div>
      
      <!-- Main content -->
      <div class="text-center relative z-10">
        <!-- Large Atom Visualization -->
        <div class="relative w-80 h-80 mx-auto mb-8">
          <div class="absolute inset-0 flex items-center justify-center">
            <!-- Orbits -->
            <div class="absolute w-64 h-64 border-4 border-white/30 rounded-full animate-spin" style="animation-duration:20s;"></div>
            <div class="absolute w-48 h-48 border-4 border-white/30 rounded-full animate-spin" style="animation-duration:15s;transform:rotate(60deg);"></div>
            <div class="absolute w-32 h-32 border-4 border-white/30 rounded-full animate-spin" style="animation-duration:10s;transform:rotate(120deg);"></div>
            
            <!-- Electrons -->
            <div class="absolute w-64 h-64 animate-spin" style="animation-duration:20s;">
              <div class="absolute top-0 left-1/2 w-5 h-5 bg-white rounded-full shadow-lg -ml-2.5"></div>
            </div>
            <div class="absolute w-48 h-48 animate-spin" style="animation-duration:15s;transform:rotate(60deg);">
              <div class="absolute top-0 left-1/2 w-5 h-5 bg-purple-300 rounded-full shadow-lg -ml-2.5"></div>
            </div>
            <div class="absolute w-32 h-32 animate-spin" style="animation-duration:10s;transform:rotate(120deg);">
              <div class="absolute top-0 left-1/2 w-5 h-5 bg-amber-300 rounded-full shadow-lg -ml-2.5"></div>
            </div>
            
            <!-- Nucleus -->
            <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-amber-400 rounded-full shadow-2xl"></div>
          </div>
        </div>
        
        <h2 class="text-5xl font-extrabold text-white mb-4 drop-shadow-lg">PhySphere</h2>
        <p class="text-xl text-white/90 mb-6 max-w-md mx-auto drop-shadow">
          Eksplorasi dunia fisika dengan simulasi interaktif Gerak Harmonik Sederhana
        </p>
        
        <div class="inline-flex items-center gap-3 px-6 py-3 bg-white/20 backdrop-blur-md rounded-full text-white font-medium shadow-xl">
          <span class="text-2xl">⚛️</span>
          <span>Belajar Fisika Jadi Lebih Seru!</span>
        </div>
      </div>
    </div>
    
  </div>


  <script>
    (function(){
      function el(id){return document.getElementById(id)}
      
      // Tab Switcher
      const tabs = document.querySelectorAll('.auth-tab');
      const loginContainer = el('login-container');
      const registerContainer = el('register-container');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function(){
          const tabName = this.getAttribute('data-tab');
          
          // Update active tab
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Show/hide containers
          if(tabName === 'login'){
            loginContainer.classList.add('active');
            registerContainer.classList.remove('active');
          } else {
            registerContainer.classList.add('active');
            loginContainer.classList.remove('active');
          }
        });
      });
      
      // Cek apakah sudah login dengan Supabase
      (async function() {
        try {
          await (window.__supabaseReady || Promise.resolve());
        } catch(e) {
          console.error('Supabase init error', e);
        }
        if (!window.supabase) return;
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          window.location.href = '/PhySphere';
        }
      })();

      // LOGIN Form
      const loginForm = el('login-form');
      loginForm.addEventListener('submit', async function(e){
        e.preventDefault();
        
        const email = (el('login-email').value||'').trim().toLowerCase();
        const pass = (el('login-password').value||'');
        const msg = el('login-msg'); msg.textContent = '';
        
        if(!email || !pass){ msg.textContent = 'Email dan password wajib diisi.'; return; }

        try{
          await (window.__supabaseReady || Promise.resolve());
        }catch(e){ console.error('Supabase init error (login):', e); }
        if (!window.supabase) {
          msg.textContent = 'SDK Supabase gagal dimuat.';
          return;
        }

        msg.textContent = 'Masuk...';
        msg.classList.remove('text-red-600');
        msg.classList.add('text-purple-600');
        
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email,
          password: pass,
        });

        if (error) {
          msg.classList.remove('text-purple-600');
          msg.classList.add('text-red-600');
          msg.textContent = 'Email atau password salah.';
          return;
        }

        try{ sessionStorage.setItem('pysphere_active_page','beranda'); }catch(e){}
        window.location.href = '/PhySphere';
      });
      
      // REGISTER Form
      const registerForm = el('register-form');
      registerForm.addEventListener('submit', async function(e){
        e.preventDefault();
        
        const name = (el('reg-name').value||'').trim();
        const email = (el('reg-email').value||'').trim().toLowerCase();
        const pass = el('reg-password').value||'';
        const msg = el('reg-msg'); msg.textContent = '';
        
        if(!name || !email || !pass){ msg.textContent = 'Semua field wajib diisi.'; return; }
        
        try{ await (window.__supabaseReady || Promise.resolve()); }catch(e){}
        if (!window.supabase) { msg.textContent = 'SDK Supabase gagal dimuat.'; return; }

        msg.textContent = 'Mendaftarkan...';
        msg.classList.remove('text-red-600');
        msg.classList.add('text-purple-600');
        
        const { data, error } = await supabase.auth.signUp({
          email: email,
          password: pass,
          options: {
            data: { full_name: name }
          }
        });

        if (error) {
          msg.classList.remove('text-purple-600');
          msg.classList.add('text-red-600');
          msg.textContent = 'Error: ' + error.message;
          return;
        }

        const newUser = data?.user || (data?.session && data.session.user) || null;
        if (!newUser) {
          msg.classList.remove('text-red-600');
          msg.classList.add('text-purple-600');
          msg.textContent = 'Registrasi berhasil. Cek email untuk konfirmasi.';
          return;
        }

        try {
          await supabase.from('profile').upsert({
            id: newUser.id,
            full_name: name,
            email: email,
            materi_progress: { "ghs": false, "pegas": false, "bandul": false, "getaran": false },
            updated_at: new Date().toISOString()
          }, { onConflict: 'id' });
        } catch(e) {
          console.error('Profile error', e);
        }

        msg.textContent = 'Berhasil! Mengarahkan...';
        try{ sessionStorage.setItem('pysphere_active_page','beranda'); }catch(e){}
        window.location.href = '/PhySphere';
      });
      
      // Google OAuth Login
      const googleLoginBtn = el('google-login');
      if(googleLoginBtn){
        googleLoginBtn.addEventListener('click', async function(){
          try{ await (window.__supabaseReady || Promise.resolve()); }catch(e){}
          if (!window.supabase) return;
          
          await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin + '/PhySphere' }
          });
        });
      }
      
      // Google OAuth Register
      const googleRegisterBtn = el('google-register');
      if(googleRegisterBtn){
        googleRegisterBtn.addEventListener('click', async function(){
          try{ await (window.__supabaseReady || Promise.resolve()); }catch(e){}
          if (!window.supabase) return;
          
          await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin + '/PhySphere' }
          });
        });
      }
    })();
  </script>
</body>
</html>
