<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhySphere â€” Masuk</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/src/css/style.css">
  <script src="/src/js/supabase-client.js"></script>
</head>
<body class="auth-body flex items-center justify-center">

  <div class="physics-particle" style="--tx:60px;--ty:-40px;width:80px;height:80px;top:15%;left:20%;animation-delay:0s;"></div>
  <div class="physics-particle" style="--tx:-80px;--ty:90px;width:100px;height:100px;top:40%;left:70%;animation-delay:3s;"></div>
  <div class="physics-particle" style="--tx:100px;--ty:-60px;width:60px;height:60px;top:70%;left:40%;animation-delay:6s;"></div>

  <div class="physics-wave"></div>

  <div class="auth-card text-center">
    <div class="physics-logo">
      <div class="physics-nucleus"></div>
      <div class="physics-orbit"><div class="physics-electron"></div></div>
      <div class="physics-orbit"><div class="physics-electron"></div></div>
      <div class="physics-orbit"><div class="physics-electron"></div></div>
    </div>
    <h1 class="text-2xl font-bold text-purple-800 mb-4">Selamat datang di PhySphere</h1>
    <p class="text-slate-600 mb-6">Masuk untuk melanjutkan ke simulasi dan kuis interaktif.</p>

    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="login.html" class="auth-btn auth-btn-primary">Login</a>
      <a href="register.html" class="auth-btn auth-btn-secondary">Register</a>
    </div>

    <div class="mt-6 flex justify-center">
      <button id="login-google" class="auth-btn auth-btn-secondary inline-flex items-center gap-2 justify-center whitespace-nowrap">
        <img src="/src/img/google-logo.png" alt="Google" style="height:20px;width:20px;object-fit:contain;" onerror="this.style.display='none'">
        <span>Login dengan Google</span>
      </button>
    </div>

    <div class="mt-6 text-sm text-slate-500">Jika sudah login, Anda akan diarahkan otomatis ke halaman utama.</div>
  </div>

  <script>
    (function(){
      const btn = document.getElementById('login-google');
      if(!btn) return;
      btn.addEventListener('click', async function(){
        try{
          await (window.__supabaseReady || Promise.resolve());
        }catch(e){ console.warn('Supabase init error', e); }

        if(!window.supabase || !window.supabase.auth || typeof window.supabase.auth.signInWithOAuth !== 'function'){
          alert('Layanan autentikasi belum tersedia saat ini. Coba lagi nanti.');
          return;
        }

        const redirectTo = window.location.origin + '/src/html/PhySphere.html';
        try{
          await supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } });
        }catch(err){
          console.error('Google signin error', err);
          alert('Gagal memulai proses login Google. Cek konsol untuk detail.');
        }
      });
    })();
  </script>

    <script>
      (function(){
        function tryPaths(paths){
          return paths.reduce((p, path) => {
            return p.then(found => {
              if(found) return found;
              // Use HEAD first to avoid downloading large files
              return fetch(path, { method: 'HEAD' }).then(resp => {
                if(resp && resp.ok) return path;
                return null;
              }).catch(() => null);
            });
          }, Promise.resolve(null));
        }

        function attachCandidateLink(selector, candidates){
          const el = document.querySelector(selector);
          if(!el) return;
          el.addEventListener('click', function(ev){
            ev.preventDefault();
            tryPaths(candidates).then(path => {
              if(path) window.location.href = path;
              else window.location.href = el.getAttribute('href');
            });
          });
        }

        attachCandidateLink('a[href="login.html"]', ['login.html','/login.html','src/html/login.html','/src/html/login.html','/login']);
        attachCandidateLink('a[href="register.html"]', ['register.html','/register.html','src/html/register.html','/src/html/register.html','/register']);
      })();
    </script>

</body>
</html>
