<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhySphere â€” Masuk</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/style.css">
  <script src="../js/supabase-client.js"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-gradient-to-b from-purple-50 to-yellow-50">
  <div class="max-w-md w-full p-6">
    <div class="card text-center">
      <h1 class="text-2xl font-bold text-purple-800 mb-4">Selamat datang di PhySphere</h1>
      <p class="text-slate-600 mb-6">Masuk untuk melanjutkan ke simulasi dan kuis interaktif.</p>
      <div class="flex gap-4 justify-center">
        <a href="login.html" class="vlab-button bg-blue-600 text-white px-6 py-2 rounded-md">Login</a>
        <a href="register.html" class="vlab-button bg-white border px-6 py-2 rounded-md">Register</a>
      </div>
      <!-- Google OAuth button -->
      <div class="mt-4 flex justify-center">
  <button id="login-google" class="vlab-button bg-white border px-6 py-2 rounded-md inline-flex items-center gap-2 justify-center whitespace-nowrap">
          <!-- External PNG (place the file at /src/img/google-logo.png). If missing, the image will be hidden. -->
          <img src="../img/google-logo.png" alt="Google" style="height:20px;width:20px;object-fit:contain;" onerror="this.style.display='none'">
          <span>Login with Google</span>
        </button>
      </div>
      <div class="mt-6 text-sm text-slate-500">Jika sudah login, Anda akan diarahkan otomatis ke halaman utama.</div>
    </div>
  </div>
  <script>
    (function(){
      const btn = document.getElementById('login-google');
      if(!btn) return;
      btn.addEventListener('click', async function(){
        try{
          // Wait for Supabase client to be ready (supabase-client.js exposes window.__supabaseReady)
          await (window.__supabaseReady || Promise.resolve());
        }catch(e){ console.warn('Supabase init error', e); }

        if(!window.supabase || !window.supabase.auth || typeof window.supabase.auth.signInWithOAuth !== 'function'){
          // As a fallback, redirect user to PhySphere and let the other pages handle sign-in
          alert('Layanan autentikasi belum tersedia saat ini. Coba lagi nanti.');
          return;
        }

        const redirectTo = window.location.origin + '/src/html/PhySphere.html';
        try{
          await supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } });
        }catch(err){
          console.error('Google signin error', err);
          alert('Gagal memulai proses login Google. Cek konsol untuk detail.');
        }
      });
    })();
  </script>
  
</body>
</html>
